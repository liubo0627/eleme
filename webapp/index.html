<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/mui.min.js"></script>
    
    
    
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link href="css/index.css" rel="stylesheet"/>
    <script type="text/javascript" charset="utf-8">
      	mui.init();
    </script>
</head>
<body>
	
	
	 <!----------body------------->
	 <div class="mui-content"> 
	<!---------------底部导航开始---------------------------------------->	
	 	<nav id='footer' class="mui-bar mui-bar-tab">
	     <a class="mui-tab-item mui-active" href="#home">
	         <span class="mui-icon mui-icon-home" ></span>
	         <span class="mui-tab-label">首页</span>
	     </a>
	     <a class="mui-tab-item" href="#health">
	         <span class="mui-icon mui-icon-camera" ></span>
	         <span class="mui-tab-label">健康分析</span>
	     </a>
	     <a class="mui-tab-item" href="#discover">
	         <span class="mui-icon mui-icon-navigate" ></span>
	         <span class="mui-tab-label">发现</span>
	     </a>
	     <a class="mui-tab-item" href="#personal">
	         <span class="mui-icon mui-icon-gear"></span>
	         <span class="mui-tab-label">个人中心</span>
	     </a>
	 </nav>
	  <!---------------底部导航结束---------------------------------------->	
	  
	  <div class="content">
	  	<!--------------------首页开始--------------------------->
	  	<div id="home" class="mui-control-content mui-active">
	  		<!------------头部开始---------------->
			 <header class="mui-bar mui-bar-nav homeheader">
			     <h1 class="mui-title">首页</h1>
			 </header>
			 <!------------头部结束---------------->
			 
			 
			 
			 
			 <!---------------轮播图开始---------------------------------------->	
	  		<div id="slider" class="mui-slider" >
	  	  <div class="mui-slider-group mui-slider-loop">
	  	    <!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
	  	    <div class="mui-slider-item mui-slider-item-duplicate ">
	  	      <a href="#">
	  	        <img src="http://placehold.it/400x200" class="focus-img">
	  	      </a>
	  	    </div>
	  	    <!-- 第一张 -->
	  	    <div class="mui-slider-item">
	  	      <a href="#">
	  	        <img src="http://placehold.it/400x300" class="focus-img">
	  	      </a>
	  	    </div>
	  	    <!-- 第二张 -->
	  	    <div class="mui-slider-item" >
	  	      <a href="#">
	  	        <img src="http://placehold.it/400x300" class="focus-img">
	  	      </a>
	  	    </div>
	  	    <!-- 第三张 -->
	  	    <div class="mui-slider-item">
	  	      <a href="#">
	  	        <img src="http://placehold.it/400x300" class="focus-img">
	  	      </a>
	  	    </div>
	  	    <!-- 第四张 -->
	  	    <div class="mui-slider-item">
	  	      <a href="#">
	  	        <img src="http://placehold.it/400x300" class="focus-img">
	  	      </a>
	  	    </div>
	  	    <!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
	  	    <div class="mui-slider-item mui-slider-item-duplicate">
	  	      <a href="#">
	  	        <img src="http://placehold.it/400x300" class="focus-img">
	  	      </a>
	  	    </div>
	  	  </div>
	  	  <div class="mui-slider-indicator">
	  	    <div class="mui-indicator mui-active"></div>
	  	    <div class="mui-indicator"></div>
	  	    <div class="mui-indicator"></div>
	  	    <div class="mui-indicator"></div>
	  	  </div>
	  	</div>

	  
	   <!---------------轮播图结束---------------------------------------->	
	   
	   	<!------------fix栏开始--------------->
			 <article class="fixed">
			    <p>热门推荐</p>
			 </article>
			 
		<!------------fix栏结束--------------->
	   
	    <!---------------图文表格开始---------------------------------------->	
	 			<!--下拉刷新容器-->
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<!--数据列表-->
				<ul class="mui-table-view mui-table-view-chevron news_title">
					
				</ul>
			</div>
		</div> 
	      
	  <!---------------图文表格结束---------------------------------------->	
	 	</div>
	 	<!--------------------首页结束--------------------------->	
	 			
	 		<!--------------------发现开始--------------------------->
			<div id="discover" class="mui-control-content">
				<!------------头部开始---------------->
				 <header class="mui-bar mui-bar-nav">
				     <h1 class="mui-title">健康咨询</h1>
				 </header>
				 <!------------头部结束---------------->
					<!---------------图文表格开始---------------------------------------->	
	 			<article class="discover_tab">
			    	<a class="news_cate">健康资讯</a>
			    	<a class="news_cate">保健资讯</a>
			    	<a class="news_cate">饮食保健</a>
			    	<a class="news_cate">小验方</a>
			 	</article>	
	 			<!--下拉刷新容器-->
				<div class=box>
					<ul class="mui-table-view news">
					   
					</ul>
				</div>
	 					
			</div>
		
	      
	  
				
			<!--------------------发现结束--------------------------->
	 
	  		<!--------------------健康开始--------------------------->
			<div id="health" class="mui-control-content">
				<!------------头部开始---------------->
			 <header class="mui-bar mui-bar-nav">
			     <h1 class="mui-title" >健康</h1>
			 </header>
			 <!------------头部结束---------------->
				<ul class="mui-table-view" id="discover_list">
				    
				    健康
				</ul>
			</div>	
			<!--------------------健康结束--------------------------->
			
			<!--------------------个人中心开始--------------------------->
			<div id="personal" class="mui-control-content">
					<!------------头部开始---------------->
			 <header class="mui-bar mui-bar-nav">
			     <h1 class="mui-title">我</h1>
			 </header>
			 			<!------------头部结束---------------->
				<ul class="mui-table-view userinfo">
				    <li class="mui-table-view-cell mui-media">
				        
				           
				            <div class="mui-media-body" id="user">
				                <p class="mui-ellipsis mui-icon mui-icon-contact"></p>
				                <p class="mui-ellipsis loading"><a href="pages/login/login.html" onclick="window.location.href='pages/login/login.html'">立即登录</a>  <a href="pages/register/register.html">立即注册</a>
				                </p>
				            </div>
				        
				    </li>
				   
				    
				</ul>
				
				<ul class="mui-table-view person-list">
				    <li class="mui-table-view-cell mui-media">
				        <a href="javascript:;">
				            <i style="color:red" class="mui-icon mui-icon-spinner mui-spin iconfont"></i>
				            <p class="help-text" >我的健康</p>
				        </a>
				    </li>
				    <li style="color:#fff" class="mui-table-view-cell mui-media">
				        <a href="pages/collect/collect.html">
				            <i style="color:blue" class="mui-icon mui-icon-spinner mui-spin iconfont"></i>
				            <p class="help-text">我的收藏</p>
				        </a>
				    </li>
				    
				</ul>
				
				<ul class="mui-table-view person-list">
				    <li class="mui-table-view-cell mui-media">
				        <a href="javascript:;">
				            <i style="color:green" class="mui-icon mui-icon-spinner mui-spin iconfont"></i>
				            <p class="help-text">在线客服</p>
				        </a>
				    </li>
				    <li class="mui-table-view-cell mui-media">
				        <a href="javascript:;">
				            <i style="color:orange" class="mui-icon mui-icon-spinner mui-spin iconfont"></i>
				            <p class="help-text">帮助手册</p>
				        </a>
				    </li>
				    
				</ul>
				
				<ul class="mui-table-view person-list">
				    <li style="color:teal" class="mui-table-view-cell mui-media">
				        <a href="pages/advice/advice.html">
				            <i class="mui-icon mui-icon-spinner mui-spin iconfont"></i>
				            <p class="help-text">意见反馈</p>
				        </a>
				    </li>
				    <li class="mui-table-view-cell mui-media">
				        <a href="javascript:;">
				            <i class="mui-icon mui-icon-spinner mui-spin iconfont"></i>
				            <p class="help-text">幸福</p>
				        </a>
				    </li>
				    
				</ul>
				
			</div>	
			<!--------------------个人中心结束--------------------------->
			
			
	 
	  </div>		
	 </div>	
	
</body>
</html>
<script src="js/index.js"></script>
	<script src="js/index1.js"></script>
	<script>
			mui.init({
				pullRefresh: {
					container: '#pullrefresh',
//					down: {
//						callback: pulldownRefresh
//					},
					up: {
						contentrefresh: '正在加载...',
						callback: pullupRefresh
					}
				}
				
			});
			/**
			 * 下拉刷新具体业务实现
			 */
//			function pulldownRefresh() {
//				setTimeout(function() {
//					var table = document.body.querySelector('.mui-table-view');
//					var cells = document.body.querySelectorAll('.mui-table-view-cell');
//					for (var i = cells.length, len = i + 3; i < len; i++) {
//						var li = document.createElement('li');
//						li.className = 'mui-table-view-cell';
//						li.innerHTML = '<a class="mui-navigate-right">Item ' + (i + 1) + '</a>';
//						//下拉刷新，新纪录插到最前面；
//						table.insertBefore(li, table.firstChild);
//					}
//					mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
//				}, 1500);
//			}
			var count = 0;
			/**
			 * 上拉加载具体业务实现
			 */
			var flag=true;
			function pullupRefresh() {
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
					var table = document.body.querySelector('.mui-table-view');
					
					var cells = document.body.querySelectorAll('.mui-table-view-cell');
//					for (var i = cells.length, len = i + 5; i < len; i++) {
//						console.log(1231)
//						var li = document.createElement('li');
//						li.className = 'mui-table-view-cell mui-media';
//						li.innerHTML = '<a href="javascript:;">'
//						              +'<img class="mui-media-object mui-pull-left" src="http://placehold.it/40x30">'
//						              +'<div class="mui-media-body">'
//	                
//	                  				  +'<p class="mui-ellipsis">能和心爱的人一起睡觉，是件幸福的事情；可是，打呼噜怎么办？</p>'
//	              					  +'</div>'
//	          						 +'</a>';
//						table.appendChild(li);
//						
//					}
					//--------------------
					if(flag){
						mui.ajax('http://10.36.132.129:3000/api/news',{
						data:{
							
						},
						jsonp:'callback',
						dataType:'jsonp',//服务器返回json格式数据
						type:'get',//HTTP请求类型
						success:function(data){
							console.log(JSON.parse(data)[0].title)
							console.log(JSON.parse(data)[0].img)
							var str='';
							
							var arr=JSON.parse(data)
							
							for(var i=0;i<arr.length;i++){
								var li = document.createElement('li');
								//测试修改pengff
								li.innerHTML='<li data-id="'+arr[i]._id+'" class="mui-table-view-cell mui-media newstitle">'
					        		 	+'<a href="javascript:;">'
					            		+'<img class="mui-media-object mui-pull-left" src="http://10.36.132.129:3000/'+arr[i].img+'">'
					            		+'<div class="mui-media-body">'
					                	+'<p class="mui-ellipsis">'+arr[i].title+'</p>'
					            		+'</div>'
					        			+'</a>'
					    				+'</li>';
								
								table.appendChild(li)
								
							}
							
							if(arr.length-table.childElementCount<=0){
									flag=false
								}else{
									flag=true
								}
								
								
						}
					});
						
					}
					
					//--------------------
					
				}, 1500);
			}
			if (mui.os.plus) {
				mui.plusReady(function() {
					setTimeout(function() {
						mui('#pullrefresh').pullRefresh().pullupLoading();
						
					}, 1000);

				});
			} else {
				mui.ready(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
					
				});
			}
			
			
		
			
		</script>
